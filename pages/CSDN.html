<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.1.0/echarts.min.js"></script>
    <title>CSDN-Focus Popularity</title>
    <style>
        table {
            border-collapse: collapse;
            text-align: center;
            font: 1em sans-serif;
            width: 100%;
            max-width: 1000px;
            margin: 30px auto;
        }

        td,
        th {
            border: 1px solid #ccc;
            line-height: 2;
        }

        #eChartx {
            display: block;
            width: 100%;
            height: 400px;

        }
    </style>
</head>

<body>
    <div id="eChartx"></div>

    <a target="_blank" href="https://greasyfork.org/zh-CN/scripts/420352-csdn-focus">
        <h1>
            <hr>
            <hr>
        </h1>
    </a>

    <table id="table">
        <thead>
            <tr>
                <th width=40%>日期</th>
                <th width=30%>安装</th>
                <th>更新</th>
            </tr>
        </thead>
    </table>
</body>

</html>
<script>
    const fetchData = async () => {
        const res = await fetch('https://greasyfork.org/scripts/420352/stats.json');
        const data = await res.json();
        // console.log("fetchData", data);
        return data;
    }
    async function resolveData() {
        const dataJson = await fetchData();
        const dataArr = Object.entries(dataJson).reverse();

        console.time("resolveData");
        const dom = dataArr.reduce((acc, cur) => {
            return acc + `<tr>
                            <td>${cur[0]}</td>
                            <td>${cur[1].installs}</td>
                            <td>${cur[1].update_checks}</td>
                          </tr>`;
        }, "");
        console.timeEnd("resolveData");

        console.time("appendData");
        let dom2 = ``;
        for (const i of dataArr) {
            dom2 = `<tr>
                        <td>${i[0]}</td>
                        <td>${i[1].installs}</td>
                        <td>${i[1].update_checks}</td>
                    </tr>` + dom2;
        }
        console.timeEnd("appendData");

        renderEct(dataArr);
        table.insertAdjacentHTML('beforeend', dom);
    }
    resolveData();

    function renderEct(data) {
        let dt = [], ins = [], udp = [];
        for (const i of data) {
            // console.log(i);
            dt.push(i[0])
            ins.push(i[1].installs * 10)
            udp.push(i[1].update_checks)
        }
        // console.log(dt, ins, udp);


        // 基于准备好的dom，初始化echarts实例
        var ECharts = echarts.init(eChartx, null, { renderer: "svg" });

        // 指定图表的配置项和数据
        var option = {

            title: {
                // text: 'CSDN-Focus Popularity'
            },
            // 
            tooltip: {
                trigger: 'axis',
                // showContent: true,
                triggerOn: "mousemove",
            },
            legend: {
                data: ['安装量', "检查更新"]
            },
            xAxis: {
                data: dt
            },
            yAxis: {
                left: 23
            },
            dataZoom: [
                {
                    type: 'slider',
                    start: 0,
                    end: 50
                }
            ],
            series: [{
                name: '安装量',
                type: 'line',
                smooth: true,
                data: ins,
            }, {
                name: '检查更新',
                smooth: true,
                type: 'line',
                data: udp
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        ECharts.setOption(option);

        window.onresize = function () {
            ECharts.resize();
        }
    }
</script>